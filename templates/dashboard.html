<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NQ=F Real-Time Market Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Dashboard CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navbar navbar-dark bg-dark sticky-top" role="navigation" aria-label="Main navigation">
        <div class="container-fluid">
            <div class="navbar-brand d-flex align-items-center gap-2">
                <i class="fas fa-chart-line"></i>
                <span>NQ=F Real-Time Dashboard</span>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div id="navbar-time" class="navbar-text small">
                    <span id="navbar-current-time" aria-label="Current time">--:--:-- ET</span>
                </div>
                <div id="navbar-status" class="navbar-text">
                    <span id="navbar-market-status" class="badge bg-secondary" aria-label="Market status">LOADING</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main class="container-fluid dashboard-container" role="main">
        <!-- Loading Indicator (Initially Hidden) -->
        <div id="refresh-indicator" class="refresh-indicator" role="status" aria-live="polite" aria-label="Data refresh indicator">
            <div class="spinner-border spinner-border-sm" role="presentation">
                <span class="visually-hidden">Refreshing...</span>
            </div>
            <span class="ms-2">Refreshing data...</span>
        </div>

        <!-- Error Alert -->
        <div id="error-alert" class="alert alert-danger alert-dismissible fade" role="alert" style="display: none;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="error-message">Error loading data</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            
            <!-- 1. Market Status Timer (Top Left) -->
            <section id="market-status-card" class="dashboard-card market-status-card" aria-label="Market Status and Timer">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-clock me-2"></i>Market Status
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Current Time -->
                    <div class="status-time-display">
                        <div id="market-current-time" class="time-value" aria-label="Current time in Eastern Time">--:--:--</div>
                        <div class="time-timezone">ET</div>
                    </div>

                    <!-- Market Status Badge -->
                    <div class="market-status-badge mt-3">
                        <span id="market-status-badge" class="badge status-badge-closed" aria-label="Current market status">
                            <i class="fas fa-circle-notch me-2"></i>LOADING
                        </span>
                    </div>

                    <!-- Countdown to Next Event -->
                    <div class="next-event-section mt-4">
                        <div class="countdown-label">Next Event</div>
                        <div id="countdown-display" class="countdown-value" aria-label="Countdown to next market event">-</div>
                        <div id="countdown-type" class="countdown-type">-</div>
                    </div>

                    <!-- Hours of Operation -->
                    <div class="hours-section mt-4">
                        <div class="hours-label">Hours of Operation</div>
                        <div id="hours-text" class="hours-value">Sun 6 PM - Fri 5 PM ET</div>
                    </div>
                </div>
            </section>

            <!-- 1.5. Data Freshness Countdown Timer -->
            <section id="data-freshness-card" class="dashboard-card data-freshness-card" aria-label="Data Freshness Countdown Timer">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-sync-alt me-2"></i>Data Freshness
                    </h3>
                </div>
                <div class="card-body d-flex flex-column">
                    <!-- Traffic Light Status Indicator -->
                    <div class="freshness-status-wrapper mb-4">
                        <div id="freshness-light" class="traffic-light" aria-live="polite" aria-label="Data freshness status">
                            <div id="freshness-indicator" class="light-indicator status-green"></div>
                        </div>
                        <div class="freshness-status-text ms-3">
                            <div id="freshness-status-label" class="status-label">Fresh Data</div>
                            <div id="freshness-status-name" class="status-name text-muted small">Green: Data is fresh</div>
                        </div>
                    </div>

                    <!-- Countdown Timer Display (MM:SS) -->
                    <div class="countdown-timer-wrapper mb-4 text-center">
                        <div id="countdown-timer" class="countdown-display" aria-label="Countdown to next data refresh">10:02</div>
                        <div class="countdown-subtext text-muted small">until next refresh</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="freshness-progress-wrapper mb-3">
                        <div class="progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Data freshness progress">
                            <div id="freshness-progress-bar" class="progress-bar progress-fill-green" style="width: 0%"></div>
                        </div>
                        <div class="progress-labels mt-2">
                            <small id="progress-percent" class="text-muted">0% elapsed</small>
                        </div>
                    </div>

                    <!-- Timestamps -->
                    <div class="freshness-timestamps text-center">
                        <div class="timestamp-item mb-2">
                            <div class="timestamp-label small text-muted">Last Refresh</div>
                            <div id="last-refresh-display" class="timestamp-value small">--:--:-- ET</div>
                        </div>
                        <div class="timestamp-item">
                            <div class="timestamp-label small text-muted">Next Refresh</div>
                            <div id="next-refresh-display" class="timestamp-value small">--:--:-- ET</div>
                        </div>
                    </div>

                    <!-- Manual Refresh Button (Optional) -->
                    <button id="manual-refresh-btn" class="btn btn-sm btn-outline-secondary mt-3 w-100" title="Manually trigger refresh now">
                        <i class="fas fa-redo-alt me-1"></i>Refresh Now
                    </button>
                </div>
            </section>

            <!-- 2. Current Price Display (Top Center) -->
            <section id="price-card" class="dashboard-card price-card" aria-label="Current Price Display">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-dollar-sign me-2"></i>Current Price
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Price Value -->
                    <div class="price-display">
                        <div id="current-price" class="price-value" aria-label="Current market price">--</div>
                    </div>

                    <!-- Change Indicator -->
                    <div id="price-change-section" class="price-change mt-3" aria-label="Price change">
                        <div class="change-amount">
                            <i id="change-arrow" class="fas fa-arrow-up me-2"></i>
                            <span id="change-value">--</span>
                        </div>
                        <div class="change-percent">
                            <span id="change-percent-value">--</span>%
                        </div>
                    </div>

                    <!-- Daily Range -->
                    <div class="daily-range mt-4">
                        <div class="range-label">Daily Range</div>
                        <div class="range-bar">
                            <div id="range-indicator" class="range-position"></div>
                        </div>
                        <div class="range-values">
                            <span id="daily-low" class="range-low">--</span>
                            <span id="daily-high" class="range-high">--</span>
                        </div>
                    </div>

                    <!-- Last Update Time -->
                    <div class="last-update mt-3">
                        <small id="last-update-time" class="text-muted">Last update: --</small>
                    </div>
                </div>
            </section>

            <!-- 3. Reference Levels Table (Top Right) -->
            <section id="reference-levels-card" class="dashboard-card reference-levels-card" aria-label="Reference Levels">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-layer-group me-2"></i>Reference Levels
                    </h3>
                </div>
                <div class="card-body p-0">
                    <!-- Reference Levels Table -->
                    <div class="reference-levels-table-wrapper">
                        <table class="table table-sm table-hover mb-0" role="table">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Level</th>
                                    <th scope="col" class="text-end">Price</th>
                                    <th scope="col" class="text-end">Distance</th>
                                    <th scope="col" class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody id="reference-levels-body">
                                <!-- Populated by JavaScript -->
                                <tr class="table-loading">
                                    <td colspan="4" class="text-center py-3">
                                        <span class="spinner-border spinner-border-sm me-2"></span>Loading...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 4. Session Ranges (Bottom Left) -->
            <section id="session-ranges-card" class="dashboard-card session-ranges-card" aria-label="Session Ranges">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-globe me-2"></i>Session Ranges
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Session Cards Container -->
                    <div class="sessions-container" id="sessions-container">
                        <!-- Populated by JavaScript -->
                        <div class="text-center py-3">
                            <span class="spinner-border spinner-border-sm me-2"></span>Loading...
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. Fibonacci Pivots (Bottom Center) -->
            <section id="fibonacci-card" class="dashboard-card fibonacci-card" aria-label="Fibonacci Pivots">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-project-diagram me-2"></i>Fibonacci Pivots
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Tab Navigation -->
                    <div class="nav nav-tabs nav-fill mb-3" role="tablist">
                        <button class="nav-link active" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily-pivots" type="button" role="tab" aria-controls="daily-pivots" aria-selected="true">Daily</button>
                        <button class="nav-link" id="weekly-tab" data-bs-toggle="tab" data-bs-target="#weekly-pivots" type="button" role="tab" aria-controls="weekly-pivots" aria-selected="false">Weekly</button>
                    </div>

                    <!-- Pivot Levels Content -->
                    <div class="tab-content">
                        <!-- Daily Pivots -->
                        <div class="tab-pane fade show active" id="daily-pivots" role="tabpanel" aria-labelledby="daily-tab">
                            <div id="daily-pivots-content" class="pivots-content">
                                <!-- Populated by JavaScript -->
                                <div class="text-center py-3">
                                    <span class="spinner-border spinner-border-sm me-2"></span>Loading...
                                </div>
                            </div>
                        </div>

                        <!-- Weekly Pivots -->
                        <div class="tab-pane fade" id="weekly-pivots" role="tabpanel" aria-labelledby="weekly-tab">
                            <div id="weekly-pivots-content" class="pivots-content">
                                <!-- Populated by JavaScript -->
                                <div class="text-center py-3">
                                    <span class="spinner-border spinner-border-sm me-2"></span>Loading...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 6. Hourly Block Segmentation (Bottom Right) -->
            <section id="hourly-blocks-card" class="dashboard-card hourly-blocks-card" aria-label="Hourly Block Segmentation">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-cubes me-2"></i>Hourly Blocks
                    </h3>
                </div>
                <div class="card-body">
                    <!-- Progress Bar -->
                    <div class="blocks-progress-section">
                        <div class="blocks-label">Block Progress</div>
                        <div class="blocks-bar-container">
                            <div id="blocks-bar" class="blocks-bar">
                                <!-- Block indicators will be added here -->
                                <div class="block-placeholder"></div>
                            </div>
                        </div>
                        <div id="blocks-count" class="blocks-count-text">-- of 7 blocks</div>
                    </div>

                    <!-- Current Block OHLC -->
                    <div class="current-block-section mt-4">
                        <div class="blocks-label">Current Block</div>
                        <div id="current-block-ohlc" class="block-ohlc-grid">
                            <!-- Populated by JavaScript -->
                            <div class="text-center py-3 col-12">
                                <span class="spinner-border spinner-border-sm me-2"></span>Loading...
                            </div>
                        </div>
                    </div>

                    <!-- Block Time -->
                    <div class="block-time mt-3">
                        <small id="block-time-text" class="text-muted">Block time: --</small>
                    </div>
                </div>
            </section>

        </div>

        <!-- Footer -->
        <footer class="dashboard-footer text-center py-3 mt-4" aria-label="Footer">
            <small class="text-muted">
                Data refreshes every 602 seconds (10 minutes 2 seconds).
                <span id="last-refresh-time" aria-label="Last refresh time">Never</span>
            </small>
        </footer>
    </main>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Dashboard JS -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
